<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mindful Jaap - Sadhna Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --bg: #ffffff; --text: #000; --accent: #ff9800; --border: #eee; --card: #f9f9f9; --gold: #d4af37; }
        body.dark { --bg: #000; --text: #fff; --border: #222; --card: #111; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; transition: 0.3s; height: 100vh; display: flex; flex-direction: column; overflow: hidden; text-align: center; }
        .streak-banner { background: #fff3e0; padding: 10px; font-weight: bold; color: #e65100; font-size: 18px; border-bottom: 2px solid #ffe0b2; }
        #onboarding { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; flex-direction: column; justify-content: center; padding: 30px; }
        input { padding: 15px; margin: 10px 0; border-radius: 10px; border: 1px solid var(--border); background: var(--card); color: var(--text); font-size: 16px; }
        .header { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .main-ui { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; position: relative; }
        .counter-circle { width: 220px; height: 220px; border-radius: 50%; border: 8px solid var(--accent); display: flex; flex-direction: column; justify-content: center; background: var(--bg); z-index: 10; position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        #main-num { font-size: 70px; font-weight: bold; margin-bottom: -10px; }
        .beads-left { font-size: 14px; color: var(--accent); font-weight: bold; margin-top: 5px; }
        .modal { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 200; padding: 20px; overflow-y: auto; text-align: left; }
        .close-btn { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 20px; float: right; cursor: pointer; }
        #certificateModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 600; align-items: center; justify-content: center; padding: 10px; }
        #certificateContent { background: #fff; color: #000; padding: 30px; border-radius: 15px; width: 340px; text-align: center; border: 8px double var(--gold); }
    </style>
</head>
<body>

    <div id="onboarding">
        <h1 style="color:var(--accent)">Mindful Jaap</h1>
        <p>‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§∏‡•ç‡§•‡§æ‡§® ‡§≤‡§ø‡§ñ‡•á‡§Ç</p>
        <input type="text" id="uName" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ">
        <input type="text" id="uLoc" placeholder="‡§∂‡§π‡§∞">
        <button onclick="saveUser()" style="background:var(--accent); color:white; border:none; padding:15px; border-radius:10px; font-size:18px; cursor:pointer;">‡§∏‡§æ‡§ß‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
    </div>

    <div class="streak-banner">üî• Streak: <span id="streak-val">0</span> Days</div>

    <div class="header">
        <div style="text-align: left;">
            <div style="font-weight: bold; font-size: 14px; color: var(--accent);" id="user-name">‡§∏‡§æ‡§ß‡§ï</div>
            <div style="font-size:10px; color:#4CAF50;">‚óè Live Now</div>
        </div>
        <div><button onclick="openModal('settingsModal')" style="background:none; border:none; font-size:20px; cursor:pointer;">‚öôÔ∏è</button></div>
    </div>

    <div class="main-ui" onclick="handleTap()">
        <div id="active-mantra" style="font-size:20px; font-weight:bold; margin-bottom:20px; color:var(--accent);">‡•ê ‡§®‡§Æ‡§É ‡§∂‡§ø‡§µ‡§æ‡§Ø</div>
        <div class="counter-circle">
            <div id="main-num">0</div>
            <div style="font-size:10px; opacity:0.6;">‡§ï‡•Å‡§≤ ‡§ú‡§æ‡§™</div>
            <div class="beads-left">‡§∂‡•á‡§∑ (Left): <span id="beads-countdown">108</span></div>
        </div>
        <div id="mala-info" style="margin-top:20px; font-weight:bold;">‡§Æ‡§æ‡§≤‡§æ: <span id="mala-count">0</span> / <span id="goal-val">1</span></div>
    </div>

    <div id="certificateModal">
        <div id="certificateContent">
            <div style="font-size: 40px;">üïâÔ∏è</div>
            <h2 style="color:var(--gold); margin:5px 0;">SADHNA CERTIFICATE</h2>
            <h3 id="cert-name" style="font-size:1.8em; margin:15px 0; color:#333; border-bottom: 2px solid var(--gold); display: inline-block;"></h3>
            <p>‡§®‡•á ‡§Ü‡§ú <b>Mindful Jaap</b> ‡§™‡§∞ ‡§Ö‡§™‡§®‡•Ä ‡§∏‡§æ‡§ß‡§®‡§æ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡•Ä‡•§</p>
            <div style="margin:15px 0; font-size:0.9em; text-align:left; background:#fdfbf0; padding:15px; border-radius:10px;">
                <div><b>‡§Æ‡§Ç‡§§‡•ç‡§∞:</b> <span id="cert-mantra"></span></div>
                <div><b>‡§Æ‡§æ‡§≤‡§æ‡§è‡§Ç:</b> <span id="cert-malas"></span></div>
                <div><b>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</b> <span id="cert-date"></span></div>
            </div>
            <div style="font-weight:bold; color:#E1306C; margin-bottom:15px;">Instagram: @mindful.jaap</div>
            <button onclick="downloadCert()" style="background:var(--gold); color:white; border:none; padding:12px 25px; border-radius:10px; font-weight:bold; cursor:pointer;">Download Certificate</button>
            <p onclick="closeModal('certificateModal')" style="margin-top:15px; cursor:pointer; opacity:0.5;">Close</p>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <button class="close-btn" onclick="closeModal('settingsModal')">X</button>
        <h2>Settings</h2>
        <p>Goal: <select id="goalSet" onchange="updateGoal()"><option value="1">1 Mala</option><option value="11">11 Malas</option></select></p>
        <p>Mantra: <select id="mList" onchange="changeMantra()">
            <option value="‡•ê ‡§®‡§Æ‡§É ‡§∂‡§ø‡§µ‡§æ‡§Ø">‡•ê ‡§®‡§Æ‡§É ‡§∂‡§ø‡§µ‡§æ‡§Ø</option>
            <option value="‡•ê ‡§ò‡•É‡§£‡§ø ‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§æ‡§Ø ‡§®‡§Æ‡§É">‡•ê ‡§ò‡•É‡§£‡§ø ‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§æ‡§Ø ‡§®‡§Æ‡§É</option>
            <option value="‡•ê ‡§∏‡•ã‡§Æ‡§æ‡§Ø ‡§®‡§Æ‡§É">‡•ê ‡§∏‡•ã‡§Æ‡§æ‡§Ø ‡§®‡§Æ‡§É</option>
            <option value="‡•ê ‡§Ö‡§Ç‡§ó‡§æ‡§∞‡§ï‡§æ‡§Ø ‡§®‡§Æ‡§É">‡•ê ‡§Ö‡§Ç‡§ó‡§æ‡§∞‡§ï‡§æ‡§Ø ‡§®‡§Æ‡§É</option>
            <option value="‡•ê ‡§¨‡•Å‡§ß‡§æ‡§Ø ‡§®‡§Æ‡§É">‡•ê ‡§¨‡•Å‡§ß‡§æ‡§Ø ‡§®‡§Æ‡§É</option>
            <option value="‡•ê ‡§¨‡•É‡§π‡§∏‡•ç‡§™‡§§‡§Ø‡•á ‡§®‡§Æ‡§É">‡•ê ‡§¨‡•É‡§π‡§∏‡•ç‡§™‡§§‡§Ø‡•á ‡§®‡§Æ‡§É</option>
            <option value="‡•ê ‡§∂‡•Å‡§ï‡•ç‡§∞‡§æ‡§Ø ‡§®‡§Æ‡§É">‡•ê ‡§∂‡•Å‡§ï‡•ç‡§∞‡§æ‡§Ø ‡§®‡§Æ‡§É</option>
            <option value="‡•ê ‡§∂‡§®‡•à‡§∂‡•ç‡§ö‡§∞‡§æ‡§Ø ‡§®‡§Æ‡§É">‡•ê ‡§∂‡§®‡•à‡§∂‡•ç‡§ö‡§∞‡§æ‡§Ø ‡§®‡§Æ‡§É</option>
            <option value="‡•ê ‡§∞‡§æ‡§π‡§µ‡•á ‡§®‡§Æ‡§É">‡•ê ‡§∞‡§æ‡§π‡§µ‡•á ‡§®‡§Æ‡§É</option>
            <option value="‡•ê ‡§ï‡•á‡§§‡§µ‡•á ‡§®‡§Æ‡§É">‡•ê ‡§ï‡•á‡§§‡§µ‡•á ‡§®‡§Æ‡§É</option>
            <option value="‡•ê ‡§π‡§Æ ‡§π‡§®‡•Å‡§Æ‡§Ç‡§§‡•á ‡§®‡§Æ‡§É">‡•ê ‡§π‡§Æ ‡§π‡§®‡•Å‡§Æ‡§Ç‡§§‡•á ‡§®‡§Æ‡§É</option>
            <option value="‡•ê ‡§ó‡§Ç ‡§ó‡§£‡§™‡§§‡§Ø‡•á ‡§®‡§Æ‡§É">‡•ê ‡§ó‡§Ç ‡§ó‡§£‡§™‡§§‡§Ø‡•á ‡§®‡§Æ‡§É</option>
            <option value="‡•ê ‡§®‡§Æ‡•ã ‡§≠‡§ó‡§µ‡§§‡•á ‡§µ‡§æ‡§∏‡•Å‡§¶‡•á‡§µ‡§æ‡§Ø">‡•ê ‡§®‡§Æ‡•ã ‡§≠‡§ó‡§µ‡§§‡•á ‡§µ‡§æ‡§∏‡•Å‡§¶‡•á‡§µ‡§æ‡§Ø</option>
            <option value="‡•ê ‡§ó‡§æ‡§Ø‡§§‡•ç‡§∞‡•Ä ‡§Æ‡§Ç‡§§‡•ç‡§∞">‡•ê ‡§ó‡§æ‡§Ø‡§§‡•ç‡§∞‡•Ä ‡§Æ‡§Ç‡§§‡•ç‡§∞</option>
            <option value="‡•ê ‡§Æ‡§π‡§æ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å‡§Ç‡§ú‡§Ø ‡§Æ‡§Ç‡§§‡•ç‡§∞">‡•ê ‡§Æ‡§π‡§æ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å‡§Ç‡§ú‡§Ø ‡§Æ‡§Ç‡§§‡•ç‡§∞</option>
        </select></p>
        <button onclick="document.body.classList.toggle('dark')" style="width:100%; padding:15px; border:1px solid #ccc; border-radius:10px; margin-top:10px;">Dark Mode</button>
    </div>

    <audio id="click-sound" src="https://www.soundjay.com/buttons/sounds/button-16.mp3"></audio>
    <audio id="alert-100" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"></audio>

    <script>
        let db = JSON.parse(localStorage.getItem('mj_v18')) || { total: 0, malas: 0, streak: 0, lastDate: '', goal: 1 };
        let user = JSON.parse(localStorage.getItem('mj_user')) || null;
        let activeM = "‡•ê ‡§®‡§Æ‡§É ‡§∂‡§ø‡§µ‡§æ‡§Ø";

        if(user) { 
            document.getElementById('onboarding').style.display = 'none'; 
            document.getElementById('user-name').innerText = user.name;
        }

        function saveUser() {
            let n = document.getElementById('uName').value; let l = document.getElementById('uLoc').value;
            if(n && l) {
                user = { name: n, loc: l };
                localStorage.setItem('mj_user', JSON.stringify(user));
                location.reload();
            }
        }

        function handleTap() {
            db.total++;
            let current = db.total % 108;
            let left = 108 - (current === 0 ? 108 : current);
            document.getElementById('click-sound').currentTime=0; document.getElementById('click-sound').play();
            if(current ===